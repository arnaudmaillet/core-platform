syntax = "proto3";

package profile.v1;

// Importation des types partagés et des wrappers Google
import "profile/v1/types.proto";
import "google/protobuf/wrappers.proto";

option go_package = "github.com/core-platform/proto/profile/v1";

// ==========================================
// SERVICES DE MODIFICATION (COMMANDES)
// ==========================================

// Gère l'identité unique et critique de l'utilisateur
service ProfileIdentityService {
  // Mise à jour du slug/handle (opération à forte cohérence)
  rpc UpdateUsername(UpdateUsernameRequest) returns (Profile);
}

// Gère l'apparence, les médias et les liens sociaux
service ProfileSettingsService {
  // Mise à jour des métadonnées textuelles (Bio, Nom affiché)
  rpc UpdateMetadata(UpdateMetadataRequest) returns (Profile);

  // Gestion des images de profil
  rpc UpdateAvatar(UpdateAvatarRequest) returns (Profile);
  rpc UpdateBanner(UpdateBannerRequest) returns (Profile);

  // Gestion des réseaux sociaux et de la confidentialité
  rpc UpdateSocialLinks(UpdateSocialLinksRequest) returns (Profile);
  rpc UpdatePrivacy(UpdatePrivacyRequest) returns (Profile);
}

// Gère les interactions automatiques et les compteurs (souvent appelé par d'autres services)
service ProfileInternalService {
  rpc IncrementPostCount(IncrementPostCountRequest) returns (Profile);
  rpc DecrementPostCount(DecrementPostCountRequest) returns (Profile);
}

// ==========================================
// MESSAGES DE REQUÊTES
// ==========================================

// --- Identity ---

message UpdateUsernameRequest {
  string account_id = 1;      // UUID
  string new_username = 2;    // Nouveau slug
}

// --- Settings & Metadata ---

message UpdateMetadataRequest {
  string account_id = 1;
  string display_name = 2;
  google.protobuf.StringValue bio = 3;
  google.protobuf.StringValue location_label = 4;
}

message UpdateAvatarRequest {
  string account_id = 1;
  google.protobuf.StringValue url = 2;
}

message UpdateBannerRequest {
  string account_id = 1;
  google.protobuf.StringValue url = 2;
}

message UpdateSocialLinksRequest {
  string account_id = 1;
  SocialLinks links = 2;      // Utilise le message défini dans types.proto
}

message UpdatePrivacyRequest {
  string account_id = 1;
  bool is_private = 2;
}

// --- Internal / Automation ---

message IncrementPostCountRequest {
  string account_id = 1;
  string post_id = 2;         // Pour l'idempotence côté serveur
}

message DecrementPostCountRequest {
  string account_id = 1;
  string post_id = 2;
}